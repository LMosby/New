<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Introduction to Data Analysis with Python</title>
<link rel="stylesheet" href="css/reveal.css">
<link rel="stylesheet" href="css/theme/cci.css">
<link href="https://fonts.googleapis.com/css?family=Poppins" rel="stylesheet">
<!-- Theme used for syntax highlighting of code -->
<link rel="stylesheet" href="lib/css/zenburn.css">
<!-- Printing and PDF exports -->
<script>
var link = document.createElement( 'link' );
link.rel = 'stylesheet';
link.type = 'text/css';
link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
document.getElementsByTagName( 'head' )[0].appendChild( link );
</script>
</head>
<body>
<div class="reveal">
<!-- Header logo -->
<!--img style="position:fixed;top:1em;right:1em;" src="img/logo_cci.png" width="15%"-->
<!-- Slide Title -->
<header style="position: absolute;top: 1em; left: 1em; z-index:10;"></header>


<div class="slides">
    <section data-menu-title="Title">
<h2>Introduction to Programming in Fiji</h2>
<h4>Lewis Mosby<br>PhD Student</h4>
</section>


    <section data-menu-title="Introduction" data-state="intro0">
        <h2>
		<b>Introductions</b>
	</h2>

	<ul>
	<li>Lewis Mosby (me)
	<li>Sam Garforth
        <li>Daniel Moore
        </ul>
        
    </section>
    


<section data-state="intro0">
        <h2>
            <b>Acknowledgements</b>
        </h2>
        
   
    <ul>
	<li>Erick Martins Ratamero (<a href="https://twitter.com/erickratamero" target="_blank">@erickratamero</a>) who gave me the majority of these slides
        <li>Philo van Kemenade (<a href="twitter.com/phivk">@phivk</a>) from whom Erick "stole" the general structure of the presentation and some of the images </li>
        <li>(Original at <a href="https://slides.com/phivk/intro2python">https://slides.com/phivk/intro2python</a>)</li>
        <li>Some material also from <a href="https://imagej.net/Introduction_into_Macro_Programming">https://imagej.net/Introduction_into_Macro_Programming</a></li>
        </ul>
    
    </section>





    <section data-state="intro0">
        <h2>These Slides</h2>
        
            <br/>
        
            <br/>
        
            <br/>
	    
	    <a href="https://moodle.warwick.ac.uk/course/view.php?id=33007" target="_blank">Moodle</a>
	    
	    <br/>
	    
	    <br/>
        
            <a href="http://tiny.cc/introfiji2" target="_blank">tiny.cc/introfiji2</a>
            
	    <br/>
       
    </section>
	
	
	
	
	
	
	<section data-state="intro0">
        <h2>Downloading Fiji</h2>
        
            <br/>
        
            <br/>
        
            <br/>
        
            <a href="https://imagej.net/Fiji/Downloads" target="_blank">https://imagej.net/Fiji/Downloads</a>
            <br/>
       
	</section>
    




    


    <section data-state="python">
        <h2>Why macros?</h2>
       
         <ul>
             <li>Automation: do the same thing many times over</li>
             <li>Reproducibility: do exactly the same thing every time, show the world what you've done</li>
             <li>Sharing: let someone else do exactly the same analysis as you</li>
             <li>Extension: do things Fiji cannot do by default</li>
         </ul>  
       
                
    </section>








    <section data-state="bb">
        <h2>VARIABLES</h2>
        
            <img src="CH922/var-name-red.png" width="500"/>
        <br/>
            <font color="#e06666">
                <b><i>Variables</i></b></font> store <i>values</i> under a specified name
            <br/>
        
    </section>






    <section data-state="bb">
        <h2>VARIABLES</h2>
        
        <img src="CH922/vars-nametags.png" width="500"/>
       
    </section>



    <section data-state="bb">
        <h2>Declaring variables in Fiji</h2>
        
            <pre><code>name = "Lewis";
gender = "male";
height = 1.68; </code></pre>
        
    </section>





   
        <section data-state="bb">
            <h2>Types of variables</h2>
            
                <p>Variables can store values of different <b><i>types</i></b>:</p>
              
                <p style="text-align: left;">
                    <font color="#e06666"><b>string</b></font> - a sequence of characters, comprising text
                </p>
                
                <pre><code>"a", "London", "X", "General Assembly"</code></pre>

                <p style="text-align: left;">
                    <font color="#e06666"><b>int</b></font> - an integer, or whole number
                </p>
                
                <pre><code>1, 5, 9999, -7</code></pre>

                <p style="text-align: left;">
                    <font color="#e06666"><b>float</b></font> - a floating point number (using a decimal point)
                </p>
                
                <pre><code>3.14, 1.68, 1.0</code></pre>

                <p style="text-align: left;">
                    <font color="#e06666"><b>bool</b></font> - boolean; binary true or false values
                </p>
                
                <pre><code>true, false</code></pre>

                
        </section>




   <section data-state="pp">
        <h2>Comments</h2>
        
            <p>When you read your code again in six months from now, you want to understand what your code does, and why. For this, you can add comments, i.e. text which is ignored by ImageJ when it executes the macro.</p>
          
            <pre><code class="C">// Define the radius of the circle to be drawn
r = 15;</code></pre>
           
<p>You can also have multi-line comments enclosed in /* ... */ blocks:</p>

            <pre><code class="C">/*
 It turned out in practice that 0.5 is a good choice for alpha, because
 it leads to fewer artifacts than anything larger, and it is large enough
 to guarantee a quick convergence.
*/
alpha = 0.5;</code></pre>
       

        
    </section>






            <section data-state="bb">
        <h2>Name vs value of a variable</h2>
        
            <p>A common pitfall is to include the name of a variable in a string. </p>
          
            <pre><code data-noescape>title = "Macro";

// BAD - literally prints "title"
// write("The name: title");
   
// GOOD - properly uses the title variable value
write("The name: " + title); </code></pre>


<p>The same principle applies when using variables which reflect parameters passed to a run() method, e.g. </p>
          
            <pre><code data-noescape>specifiedRadius = 3;

// BAD - will literally pass "specifiedRadius"
// run("Median...", "radius=specifiedRadius");
 
// GOOD - will correctly pass the radius variable value   
run("Median...", "radius=" + specifiedRadius); </code></pre>

<p>Note that whitespaces are not automatically added! </p>
            <pre><code data-noescape>specifiedMethod = "Li";

// BAD - does NOT work because the macro runs as "method=Liwhite"
// run("Auto Threshold", "method=" + userDefinedAutoThreshold + "white");

// GOOD - will correctly pass argument   
run("Auto Threshold", "method=" + userDefinedAutoThreshold + " white");</code></pre>
            
    </section>





    <section data-state="bb">
        <h2>Self-referencing</h2>
        
            <p>You can use a variable name in both sides of an assignment, for example.</p>
          
            <pre><code>amount = amount * 2;</code></pre>


<p>First, <i>amount * 2</i> is evaluated. The result is then assigned back to the variable <i>amount</i>, effectively doubling it.</p>
          
<p>A very important operation is to increment a variable's value by one; so important that there is a short form for it</p>
            <pre><code>// Both these lines do the same thing
counter = counter + 1;
counter++;</code></pre>
            
    </section>
        
   




    
    <section data-state="bb">
        <h2>Operators</h2>
        
            <p>
                <span class="s1">You can process the values in your variables by 
                    <b>
                        <i>
                            <font color="#e06666">operators</font>
                        </i>
                    </b>:
                </span>
            </p>
            <table width="100%" cellspacing="10" cellpadding="5" border="0">
                <tbody>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>=</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Assignment: assign a value to a variable </font>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>==</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Comparison: are two variables equal?</font>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>!=</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Comparison: are two variables not equal?</font>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <p class="p1">
                                <span class="s1">
                                    <b>
                                        <font style="font-size: 30px;" color="#e06666">&lt;, &gt;, &lt;=, &gt;=</font>
                                    </b>
                                </span>
                            </p>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Less-than, greater-than, less or equal, greater or equal</font>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>+, -, *, /</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Mathematical operators</font>
                        </td>
                    </tr>
                    <tr></tr>
                    <tr>
                        <td>
                            <font style="font-size: 30px;" color="#e06666">
                                <b>&& (and), || (or)</b>
                            </font>
                        </td>
                        <td>
                            <font style="font-size: 30px;">Logical operators</font>
                        </td>
                    </tr>
                </tbody>
            </table>
            
       
    </section>








        <section data-state="pp">
            <h2>Functions</h2>
            
                <p><font color="#e06666"><b><i>Functions</i></b></font> perform a collections of tasks, bundled under a specific name
                </p>
                <p>Take input <i>argument(s)</i>, execute statement(s), return output
                </p>
                <p>
                    Input and output can be of all different types
                </p>
                
                <pre><code class="C">name = "Lewis Mosby";
length = lengthOf(name);
print(length);</code></pre>
            
            <br/>
        </section>






        <section data-state="pp">
            <h2>Built in functions</h2>
            
            <p>
                <a href="https://imagej.nih.gov/ij/developer/macro/functions.html" target="_blank">https://imagej.nih.gov/ij/developer/macro/functions.html</a>
            </p>
           
        </section>


<section data-state="pp">
        <h2>Arguments</h2>
        
            <p>Arguments are parameters passed to a function. For example, the function <i>write</i> just want one parameter (the text to be written):
            </p>
          
            <pre><code class="C">write("Hello, World!");
</code></pre>

<p> If there are more parameters to be passed, they have to be separated by commas:</p>
           
            <pre><code class="C">newImage("My pretty new image", "8-bit black", 640, 480, 1);</code></pre>
       

        
    </section>


    <section data-state="pp">
        <h2>Functions</h2>
        
            <p>You can also <i>define</i> your own functions like this:
            </p>
          
            <pre><code class="C">function function_name(argument(s)){
    actions with argument(s)
    return statement
}
</code></pre>
           
            <pre><code class="C">function Gaussian(x, y, sigma){
    factor = exp(-1.0 * (pow(x, 2) + pow(y, 2)) / (2 * pow(sigma, 2)));
    return factor;
}</code></pre>
       

        
    </section>

    
    



    
        <section data-state="bb">
            <h2>Arrays</h2>
            
                <p>
                    We can store multiple values in an <b><i><font color="#e06666">array</font>:</i></b>
                </p>
                    
                <pre><code class="python">&gt;&gt;&gt; l = newArray(1, 3, 9, 4, 884328881);
&gt;&gt;&gt; m = newArray('first', 'second', 'third', 'fourth');
&gt;&gt;&gt; n = Array.concat(l, m);
&gt;&gt;&gt; Array.print(n);
1, 3, 9, 4, 884328881, first, second, third, fourth
&gt;&gt;&gt; print(n[6]);
second</code></pre>
            
            <p>An array is a ordered sequence of items (between [...]) each with their own index.</p>
		
            <p>Remember that arrays in Fiji are 0 indexed!</p>
        </section>






        <section data-state="bb">
            <h2>Some array examples
                <br/>
            </h2>
            
                <pre><code class="java">// Define function to print array name and values
function list(name, a) {
  print(name);
  for (i = 0; i < a.length; i++)
      print("   " + a[i]);
}

/* Number arrays */

a1 = newArray(10, 5, 15, 2, 1.23456);
a2 = Array.copy(a1);
list("Copy", a2);
...
Copy
   10
   5
   15
   2
   1.23456
...

a2 = Array.trim(a1, 2);
list("Trim", a2);
...
Trim
   10
   5
...

a2 = Array.sort(a1);
list("Sort", a1);
// list("Sort", a2); // Can check, but overwrites what is stored in a1 always
...
Sort
   1.23456
   2
   5
   10
   15
...

Array.fill(a1, -1);
list("Fill", a1);
...
Fill
   -1
   -1
   -1
   -1
   -1</code></pre>
           
            
        </section>

		
		
		
		
		
		
		
		        <section data-state="bb">
            <h2>Some more array examples
                <br/>
            </h2>
            
                <pre><code class="java">/* Array statistics */

a1 = newArray(10, 5, 15, 2, 1.23456);
Array.getStatistics(a1, min, max, mean, std);
print("Stats:");
print("   min: " + min);
print("   max: " + max);
print("   mean: " + mean);
print("   std dev: " + std);
...
Stats:
   min: 1.23456
   max: 15
   mean: 6.6469
   std dev: 5.8012</code></pre>
           
            
        </section>
		
		
		
		
		
		
		
		
		<section data-state="bb">
            <h2>Even more array examples
                <br/>
            </h2>
            
                <pre><code class="java">/* String arrays */

a1 = newArray("one", "two", "three", "four");
a2 = Array.copy(a1);
list("Copy", a2);
...
Copy
   one
   two
   three
   four
...

a2 = Array.trim(a1, 2);
list("Trim", a2);
...
Trim
   one
   two
...

Array.sort(a1);
list("Sort", a1);
...
Sort
   four
   one
   three
   two</code></pre>
           
            
        </section>












        <section data-state="pp">
            <h2>Conditional statements</h2>
            
                <p><b><i><font color="#e06666">Conditional statements</font></i></b> enable you to deal with multiple options.
                </p>
                <p>
                    A part of your code is executed based on the truth value of a condition. You perform conditional checks with: <b>if</b>

                </p>
                <pre><code class="C">if(condition){
    action
}</code></pre>
                <pre><code class="C">age = 17;
if(age &lt; 18){
    print("No drinks for you!");
}
... 
No drinks for you!</code></pre>
                    
        </section>




<section data-state="pp">
            <h2>Conditional statements</h2>
            
                <p>You can add an extra action that will be executed in case your condition is <b>not</b> true using <b>else</b>:
                </p>
                
                <pre><code class="C">if(condition){
    action
}
else{
    a different action
}</code></pre>
                <pre><code class="C">age = 19;
if(age &lt; 18){
    print("No drinks for you!");
}
else{
    print("Go ahead!")
}
... 
Go ahead!</code></pre>
                    
        </section>


        <section data-state="pp">
            <h2>Nested conditionals</h2>
            
                <p>You can have as many ifs inside ifs inside ifs as you want. Also ifs inside elses, and elses inside ifs...
                </p>
                
                <pre><code class="C">if(age &lt; 18){
    print("No drinks for you!");
    if(age &lt; 13){
        print("You are a child!");
    }
    else{
        print("You are a teen!");
    }
}
else{
    print("Go ahead!")
}
... 
age = 19;
Go ahead!
...
age = 17;
No drinks for you!
You are a teen!
...
age = 9;
No drinks for you!
You are a child!
</code></pre>

<p>Note the brackets!
                </p>
                    
        </section>





<section data-state="pp">
        
        
        <h2>
                Example 1
        </h2>

        <p> Create a macro that prints whether a number is: between 1500 and 2700, multiple of 5, divisible by 7. </p>
        <p>Example: 1610 should print "is between 1500 and 2700", "divisible by 7" AND "multiple of 5". </p>
        <p>25 should print only "multiple of 5". </p>
        <p>22 should print nothing.</p>
        
    </section>







<section data-state="pp">
        
        
        <h2>
                Example 1 Simple Solution
        </h2>

<pre><code class="C">number = 1610;

if(number > 1500 && number < 2700){
    print("Is between 1500 and 2700");
}
if(number % 5 == 0){
    print("Is a multiple of 5");
}
if(number % 7 == 0){
    print("Is divisible by 7");
}</code></pre>
        
    </section>









<section data-state="pp">
        
        
        <h2>
                Example 1 Thorough Solution
        </h2>

<pre><code class="C">// Ask for input number
defaultValue = 20;
input = getNumber("Enter your age", defaultValue);

// Print if default value was used
if(input == defaultValue){
    print("Invalid input, using default value: " + defaultValue);
}

// Check if number is in range
if(input > 1500 && input < 2700){
    print("Is between 1500 & 2700");
}

// Check if number is divisible by 5 and/or 7
if(input % 5 == 0){
    print("Is a multiple of 5");
}
if(input % 7 == 0){
    print("Is divisible by 7");
}</code></pre>
        
    </section>








    
        <section data-state="pp">
            <h2>For Loops</h2>
            
                <p>
                    You use <i><font color="#e06666">loops</font></i> to repeat a statement.
                
                </p>
                <p>
                   A <b><i><font color="#e06666">for-loop</font></i></b> is useful when you know how many times you want to repeat an action (e.g. for every item in a list)
                
                </p>
                
                <pre><code class="C">for(start; condition; increment){
    do something
}</code></pre>
  <p>for example:
        </p>
        <pre><code class="C">ages = newArray(18, 21, 16, 12);
for(i = 0; i < lengthOf(ages); i++){
    print(ages[i]);
}
....
18
21
16
12 </code></pre>
            
            
        </section>



    <section data-state="pp">
        <h2>Nested Loops</h2>
        
        <p>Sometimes it is necessary to have a loop inside another loop:
        </p>
        <pre><code class="C">ages = newArray(18, 21, 16, 12);
for(i = 0; i < lengthOf(ages); i++){
    for(j = 0; j &lt; ages[i]; j++){
    	print(j);
    }
}
....
1 2 3 ... 18
1 2 3 ... 21
1 2 3 ... 16
1 2 3 ... 12</code></pre>
        
    </section>


        <section data-state="pp">
        <h2>Warning!</h2>
        
        <p>It's very easy to create a loop that runs infinitely and never ends.
        </p>
        <pre><code class="C">ages = newArray(18, 21, 16, 12);
for(i=0; i< lengthOf(ages); i++){
    print(ages[i]);
    i = i - 1;
}
....
18
18
18
18
...</code></pre>
        
    </section>









<section data-state="pp">
        
        
        <h2>
                Example 2
        </h2>

        <p>Create a macro that goes through each slice on an image and print the slice number.</p>
        <p>Apply it to <a href="material/blobs.tif">blobs.tif</a> and <a href="material/head.tif">head.tif</a>.</p>
        
    </section>











<section data-state="pp">
        
        
        <h2>
                Example 2 Simple Solution
        </h2>

<pre><code class="C">for(i = 0; i < nSlices; i++){
    print(i);
}
</code></pre>
        
    </section>






<section data-state="pp">
        
        
        <h2>
                Example 2 Thorough Solution
        </h2>

<pre><code class="C">// Open input window to enter input file
#@ File (label = "Input directory", style = "file") input
open(input);

// Or: open('/media/phungd/M-USB-Y/Teaching/2019_CH922/Tests/Session 1/blobs.tif');

// Count number of slices in image
for(i = 1; i <= nSlices; i++){
    print("Slice: " + i);
}
print("Image contains: " + nSlices + " slices");
</code></pre>
        
    </section>

















       <section data-state="pp">
        <h2>Recording a macro</h2>
        
        <p>Use [Plugins -> Macros -> Record] to save commands for your macro. Hit the <i>Create</i> button to automatically put all commands into the macro editor.
        </p>
        <img src="CH922/macros.png">
        
    </section>




       <section data-state="pp">
        <h2>Making it usable</h2>
        
        <p>You might need to generalise your macro. For example, if you merge channels, you might have a command like
        </p>
        <pre><code class="C">run("Merge Channels...",
    "red=[Edges of boats.gif] green=boats.gif blue=boats.gif gray=*None*");</code></pre>
    <p>That command depends on the current image's name. To make it generic, you can do, for example:</p>
    <pre><code class="C">title = getTitle();
run("Merge Channels...",
     "red=[Edges of " + title + "] green=" + title + " blue=" + title + " gray=*None*");</code></pre>
        
    </section>




<section data-state="pp">
        
        
        <h2>
                Example 3
        </h2>

        <p> Write a macro that saves each timepoint of <a href="material/timelapse.tif">timelapse.tif</a> as a separate image with names like timelapse_1.tif, timelapse_2.tif and so on. </p>
        <p>Make sure it works no matter what the name of the image is or how many timepoints it has!</p>
        
    </section>














<section data-state="pp">
        
        
        <h2>
                Example 3 Simple Solution
        </h2>

<pre><code class="C">Stack.getDimensions(width, height, channels, slices, frames);
name = File.nameWithoutExtension;
dir = File.directory;
if(frames > 1){
    for(i=1;i<=frames; i++){
        Stack.setFrame(i);
        if(channels > 1 || slices > 1){
            run("Duplicate...", "duplicate frames=" + i);
	}
	else{
	    run("Duplicate...", " ");
	}
		
	saveAs("tif", dir + "/" + name + "_" + i + ".tif");
	close();
    }
}</code></pre>
        
    </section>






<section data-state="pp">
        
        
        <h2>
                Example 3 Thorough Solution
        </h2>

<pre><code class="C">// Open input window to enter input file
#@ File (label = "Input directory", style = "file") input
open(input);

// Or: open('/media/phungd/M-USB-Y/Teaching/2019_CH922/Tests/Session 1/timelapse.tif');

// Get information about stack of images
Stack.getDimensions(width, height, channels, slices, frames);
name = File.nameWithoutExtension;
dir = File.directory;

// Check if stack contains multiple frames (else our job is done)
if(frames > 1){

    // Loop over all frames
    for(i = 1; i <= frames; i++){

        // Select ith frame
        Stack.setFrame(i);

        // If stack contains multiple channels or slices, duplicate all relevant images
        if(channels > 1 || slices > 1){
	    run("Duplicate...", "duplicate frames=" + i);
        }
        // Else just duplicate frame
        else{
	    run("Duplicate...", " ");
        }

        // Same duplicate as new image
        saveAs("tif", dir + "/" + name + "_" + i + ".tif");

        // Remember to close image
        close();
    }
}

// Remember to close stack
close();
</code></pre>
        
    </section>














    <section data-state="pp">
        
        
        <h2>
                I want more info!
        </h2>

        <p> There are <i>many</i> more examples of macros available at <a href="https://imagej.net/macros/">https://imagej.net/macros/</a>. </p>
        <p>All functions you can use in a macro are documented at <a href="https://imagej.nih.gov/ij/developer/macro/functions.html">https://imagej.nih.gov/ij/developer/macro/functions.html</a></p>
        <p>If you have questions, the best place on the internet to ask them is <a href="http://forum.image.sc">http://forum.image.sc</a>!</p>
        
    </section>









    </div>





<img style="position:fixed;bottom:1em;right:1em;" src="CH922/logo_WMS.jpg" width="10%">
</div>

    <script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
// More info about config & dependencies:
// - https://github.com/hakimel/reveal.js#configuration
// - https://github.com/hakimel/reveal.js#dependencies
Reveal.initialize({
    controls: false,
    slideNumber: true, //-- Added for development
dependencies: [
{ src: 'plugin/markdown/marked.js' },
{ src: 'plugin/markdown/markdown.js' },
{ src: 'plugin/notes/notes.js', async: true },
{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
{ src: 'plugin/menu/menu.js' }
],
menu: {
hideMissingTitles: true,
themes: false,
transitions: false,
//markers: true,
numbers: true,
openButton: false,
titleSelector: 'span.menu-title'
}
});
</script>
</body>
</html>

